!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.decodeMmtf=r()}(this,function(){"use strict";function t(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function r(t){return new Int8Array(t.buffer,t.byteOffset,t.byteLength)}function e(t,r){var e,n,o,i=(t.byteOffset,t.byteLength);for(r||(r=new Int16Array(i/2)),e=0,n=0,o=i/2;o>e;++e,n+=2)r[e]=t[n]<<8^t[n+1]<<0;return r}function n(t,r){var e,n,o,i=(t.byteOffset,t.byteLength);for(r||(r=new Int32Array(i/4)),e=0,n=0,o=i/4;o>e;++e,n+=4)r[e]=t[n]<<24^t[n+1]<<16^t[n+2]<<8^t[n+3]<<0;return r}function o(t){return new Int32Array(t.buffer,t.byteOffset,t.byteLength/4)}function i(t,r,e){var n=t.length,o=1/r;e||(e=new Float32Array(n));for(var i=0;n>i;++i)e[i]=t[i]*o;return e}function a(t,r){var e,n;if(!r){var o=0;for(e=0,n=t.length;n>e;e+=2)o+=t[e+1];r=new t.constructor(o)}var i=0;for(e=0,n=t.length;n>e;e+=2)for(var a=t[e],u=t[e+1],s=0;u>s;++s)r[i]=a,i+=1;return r}function u(t){for(var r=1,e=t.length;e>r;++r)t[r]+=t[r-1];return t}function s(t,r,e){var n=t.length/2+r.length;e||(e=new Int32Array(n));for(var o=0,i=0,a=0,u=t.length;u>a;a+=2){var s=t[a],f=t[a+1];e[o]=s,0!==a&&(e[o]+=e[o-1]),o+=1;for(var d=0;f>d;++d)e[o]=e[o-1]+r[i],o+=1,i+=1}return e}function f(t,r,a,u){var f=t.length/4/2+r.length/2;u||(u=new Float32Array(f));var d=o(u),c=s(n(t),e(r),d);return i(c,a,u)}function d(t,r,e){var u=e?o(e):void 0,s=a(n(t),u);return i(s,r,e)}function c(e,o){function i(t){return s?-1===s.indexOf(t):!0}o=o||{};var s=o.ignoreFields,c=(e.numBonds||0,e.numAtoms||0),l=e.groupTypeList.length/4,y=e.chainIdList.length/4,L=e.chainsPerModel.length,g={numGroups:l,numChains:y,numModels:L};["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","entityList","groupList","numBonds","numAtoms","groupsPerChain","chainsPerModel"].forEach(function(t){void 0!==e[t]&&(g[t]=e[t])});var v="bondAtomList";e[v]&&i(v)&&(g[v]=n(e[v]));var h="bondOrderList";e[h]&&i(h)&&(g[h]=t(e[h])),g.xCoordList=f(e.xCoordBig,e.xCoordSmall,1e3),g.yCoordList=f(e.yCoordBig,e.yCoordSmall,1e3),g.zCoordList=f(e.zCoordBig,e.zCoordSmall,1e3);var m="bFactorList",b="bFactorBig",p="bFactorSmall";e[b]&&e[p]&&i(m)&&(g[m]=f(e[b],e[p],100));var A="atomIdList";e[A]&&i(A)&&(g[A]=u(a(n(e[A]))));var C="altLocList";e[C]&&i(C)&&(g[C]=a(n(e[C]),new Uint8Array(c)));var I="occupancyList";e[I]&&i(I)&&(g[I]=d(e[I],100)),g.groupIdList=u(a(n(e.groupIdList))),g.groupTypeList=n(e.groupTypeList);var w="secStructList";e[w]&&i(w)&&(g[w]=r(e[w]));var x="insCodeList";e[x]&&i(x)&&(g[x]=a(n(e[x]),new Uint8Array(l)));var F="sequenceIndexList";e[F]&&i(F)&&(g[F]=u(a(n(e[F])))),g.chainIdList=t(e.chainIdList);var O="chainNameList";return e[O]&&i(O)&&(g[O]=t(e[O])),g}return c});