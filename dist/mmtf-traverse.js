!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.traverseMmtf=o()}(this,function(){"use strict";function e(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function o(o,n,t){t=t||{};var r,a,d,i,s,u,l=t.firstModelOnly,m=n.onModel,c=n.onChain,p=n.onGroup,L=n.onAtom,f=n.onBond,C=0,g=0,h=0,I=0,x=0,y=-1,v=o.chainNameList,b=o.secStructList,N=o.insCodeList,O=o.sequenceIndexList,M=o.atomIdList,S=o.bFactorList,T=o.altLocList,A=o.occupancyList,P=o.bondAtomList,q=o.bondOrderList;for(r=0,a=o.chainsPerModel.length;a>r&&!(l&&C>0);++r){var z=o.chainsPerModel[C];for(m&&m({chainCount:z,modelIndex:C}),d=0;z>d;++d){var F=o.groupsPerChain[g];if(c){var j=e(o.chainIdList.subarray(4*g,4*g+4)),B=null;v&&(B=e(v.subarray(4*g,4*g+4))),c({groupCount:F,chainIndex:g,modelIndex:C,chainId:j,chainName:B})}for(i=0;F>i;++i){var G=o.groupList[o.groupTypeList[h]],k=G.atomNameList.length;if(p){var w=null;b&&(w=b[h]);var D=null;o.insCodeList&&(D=String.fromCharCode(N[h]));var E=null;O&&(E=O[h]),p({atomCount:k,groupIndex:h,chainIndex:g,modelIndex:C,groupId:o.groupIdList[h],groupType:o.groupTypeList[h],groupName:G.groupName,singleLetterCode:G.singleLetterCode,chemCompType:G.chemCompType,secStruct:w,insCode:D,sequenceIndex:E})}for(s=0;k>s;++s){if(L){var H=null;M&&(H=M[I]);var J=null;S&&(J=S[I]);var K=null;T&&(K=String.fromCharCode(T[I]));var Q=null;A&&(Q=A[I]),L({atomIndex:I,groupIndex:h,chainIndex:g,modelIndex:C,atomId:H,element:G.elementList[s],atomName:G.atomNameList[s],atomCharge:G.atomChargeList[s],xCoord:o.xCoordList[I],yCoord:o.yCoordList[I],zCoord:o.zCoordList[I],bFactor:J,altLoc:K,occupancy:Q})}I+=1}if(f){var R=G.bondAtomList;for(s=0,u=G.bondOrderList.length;u>s;++s)f({atomIndex1:I-k+R[2*s],atomIndex2:I-k+R[2*s+1],bondOrder:G.bondOrderList[s]})}h+=1}g+=1}if(x=y+1,y=I-1,f&&P)for(s=0,u=P.length;u>s;s+=2){var U=P[s],V=P[s+1];(U>=x&&y>=U||V>=x&&y>=V)&&f({atomIndex1:U,atomIndex2:V,bondOrder:q?q[s/2]:null})}C+=1}}return o});