!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):o.traverseMmtf=e()}(this,function(){"use strict";function o(o){return String.fromCharCode.apply(null,o).replace(/\0/g,"")}function e(e,n){var t,r,d,a,i=n.onModel,s=n.onChain,u=n.onGroup,m=n.onAtom,c=n.onBond,l=0,p=0,L=0,f=0,C=e.chainNameList,g=e.secStructList,h=e.insCodeList,I=e.sequenceIndexList,x=e.bFactorList,y=e.altLocList,b=e.occupancyList,v=e.bondAtomList,N=e.bondOrderList,O=!1,S=!1,T=!1,A=!1;if(e.chainsPerModel.forEach(function(n){for(i&&!O&&(O=!1===i({chainCount:n,modelIndex:l})),t=0;n>t;++t){var v=e.groupsPerChain[p];if(s&&!S&&!O){var N=o(e.chainIdList.subarray(4*p,4*p+4)),M=null;C&&(M=o(C.subarray(4*p,4*p+4))),S=!1===s({groupCount:v,chainIndex:p,modelIndex:l,chainId:N,chainName:M})}for(r=0;v>r;++r){var q=e.groupList[e.groupTypeList[L]],z=q.atomNameList.length;if(u&&!T&&!S&&!O){var F=null;g&&(F=g[L]);var P=null;e.insCodeList&&(P=String.fromCharCode(h[L]));var j=null;I&&(j=I[L]),T=!1===u({atomCount:z,groupIndex:L,chainIndex:p,modelIndex:l,groupId:e.groupIdList[L],groupType:e.groupTypeList[L],groupName:q.groupName,singleLetterCode:q.singleLetterCode,chemCompType:q.chemCompType,secStruct:F,insCode:P,sequenceIndex:j})}for(d=0;z>d;++d){if(m&&!A&&!T&&!S&&!O){var B=null;x&&(B=x[f]);var E=null;y&&(E=String.fromCharCode(y[f]));var G=null;b&&(G=b[f]),A=!1===m({atomIndex:f,groupIndex:L,chainIndex:p,modelIndex:l,atomId:e.atomIdList[f],element:q.elementList[d],atomName:q.atomNameList[d],atomCharge:q.atomChargeList[d],xCoord:e.xCoordList[f],yCoord:e.yCoordList[f],zCoord:e.zCoordList[f],bFactor:B,altLoc:E,occupancy:G})}f+=1}if(c&&!T&&!S&&!O){var k=q.bondAtomList;for(d=0,a=q.bondOrderList.length;a>d;++d)c({atomIndex1:f-z+k[2*d],atomIndex2:f-z+k[2*d+1],bondOrder:q.bondOrderList[d]})}A=!1,L+=1}T=!1,p+=1}S=!1,l+=1}),c&&v)for(d=0,a=v.length;a>d;d+=2)c({atomIndex1:v[d],atomIndex2:v[d+1],bondOrder:N?N[d/2]:null})}return e});