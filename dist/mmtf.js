!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t.MMTF=t.MMTF||{})}(this,function(t){"use strict";function r(t){function r(t){for(var r={},e=0;t>e;e++){var n=i();r[n]=i()}return r}function e(r){var e=t.subarray(a,a+r);return a+=r,e}function n(r){var e=t.subarray(a,a+r);a+=r;var n=65535;if(r>n){for(var o=[],i=0;i<e.length;i+=n)o.push(String.fromCharCode.apply(null,e.subarray(i,i+n)));return o.join("")}return String.fromCharCode.apply(null,e)}function o(t){for(var r=new Array(t),e=0;t>e;e++)r[e]=i();return r}function i(){var i,s,c,f=t[a];if(0===(128&f))return a++,f;if(128===(240&f))return s=15&f,a++,r(s);if(144===(240&f))return s=15&f,a++,o(s);if(160===(224&f))return s=31&f,a++,n(s);if(224===(224&f))return i=u.getInt8(a),a++,i;switch(f){case 192:return a++,null;case 194:return a++,!1;case 195:return a++,!0;case 196:return s=u.getUint8(a+1),a+=2,e(s);case 197:return s=u.getUint16(a+1),a+=3,e(s);case 198:return s=u.getUint32(a+1),a+=5,e(s);case 199:return s=u.getUint8(a+1),c=u.getUint8(a+2),a+=3,[c,e(s)];case 200:return s=u.getUint16(a+1),c=u.getUint8(a+3),a+=4,[c,e(s)];case 201:return s=u.getUint32(a+1),c=u.getUint8(a+5),a+=6,[c,e(s)];case 202:return i=u.getFloat32(a+1),a+=5,i;case 203:return i=u.getFloat64(a+1),a+=9,i;case 204:return i=t[a+1],a+=2,i;case 205:return i=u.getUint16(a+1),a+=3,i;case 206:return i=u.getUint32(a+1),a+=5,i;case 207:return a+=9,0;case 208:return i=u.getInt8(a+1),a+=2,i;case 209:return i=u.getInt16(a+1),a+=3,i;case 210:return i=u.getInt32(a+1),a+=5,i;case 211:return a+=9,0;case 212:return c=u.getUint8(a+1),a+=2,[c,e(1)];case 213:return c=u.getUint8(a+1),a+=2,[c,e(2)];case 214:return c=u.getUint8(a+1),a+=2,[c,e(4)];case 215:return c=u.getUint8(a+1),a+=2,[c,e(8)];case 216:return c=u.getUint8(a+1),a+=2,[c,e(16)];case 217:return s=u.getUint8(a+1),a+=2,n(s);case 218:return s=u.getUint16(a+1),a+=3,n(s);case 219:return s=u.getUint32(a+1),a+=5,n(s);case 220:return s=u.getUint16(a+1),a+=3,o(s);case 221:return s=u.getUint32(a+1),a+=5,o(s);case 222:return s=u.getUint16(a+1),a+=3,r(s);case 223:return s=u.getUint32(a+1),a+=5,r(s)}throw new Error("Unknown type 0x"+f.toString(16))}var a=0,u=new DataView(t.buffer);return i()}function e(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function n(t){return new Int8Array(t.buffer,t.byteOffset,t.byteLength)}function o(t,r){var e,n,o,i=(t.byteOffset,t.byteLength);for(r||(r=new Int16Array(i/2)),e=0,n=0,o=i/2;o>e;++e,n+=2)r[e]=t[n]<<8^t[n+1]<<0;return r}function i(t,r){var e,n,o,i=(t.byteOffset,t.byteLength);for(r||(r=new Int32Array(i/4)),e=0,n=0,o=i/4;o>e;++e,n+=4)r[e]=t[n]<<24^t[n+1]<<16^t[n+2]<<8^t[n+3]<<0;return r}function a(t){return new Int32Array(t.buffer,t.byteOffset,t.byteLength/4)}function u(t,r,e){var n=t.length,o=1/r;e||(e=new Float32Array(n));for(var i=0;n>i;++i)e[i]=t[i]*o;return e}function s(t,r){var e,n;if(!r){var o=0;for(e=0,n=t.length;n>e;e+=2)o+=t[e+1];r=new t.constructor(o)}var i=0;for(e=0,n=t.length;n>e;e+=2)for(var a=t[e],u=t[e+1],s=0;u>s;++s)r[i]=a,i+=1;return r}function c(t){for(var r=1,e=t.length;e>r;++r)t[r]+=t[r-1];return t}function f(t,r,e){var n=t.length/2+r.length;e||(e=new Int32Array(n));for(var o=0,i=0,a=0,u=t.length;u>a;a+=2){var s=t[a],c=t[a+1];e[o]=s,0!==a&&(e[o]+=e[o-1]),o+=1;for(var f=0;c>f;++f)e[o]=e[o-1]+r[i],o+=1,i+=1}return e}function g(t,r,e,n){var s=t.length/4/2+r.length/2;n||(n=new Float32Array(s));var c=a(n),g=f(i(t),o(r),c);return u(g,e,n)}function l(t,r,e){var n=e?a(e):void 0,o=s(i(t),n);return u(o,r,e)}function L(t,r){function o(t){return a?-1===a.indexOf(t):!0}r=r||{};var a=r.ignoreFields,u=(t.numBonds||0,t.numAtoms||0),f=t.groupTypeList.length/4,L=t.chainIdList.length/4,d=t.chainsPerModel.length,h={numGroups:f,numChains:L,numModels:d};["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","entityList","groupList","numBonds","numAtoms","groupsPerChain","chainsPerModel"].forEach(function(r){void 0!==t[r]&&(h[r]=t[r])});var m="bondAtomList";t[m]&&o(m)&&(h[m]=i(t[m]));var p="bondOrderList";t[p]&&o(p)&&(h[p]=e(t[p])),h.xCoordList=g(t.xCoordBig,t.xCoordSmall,1e3),h.yCoordList=g(t.yCoordBig,t.yCoordSmall,1e3),h.zCoordList=g(t.zCoordBig,t.zCoordSmall,1e3);var y="bFactorList",v="bFactorBig",b="bFactorSmall";t[v]&&t[b]&&o(y)&&(h[y]=g(t[v],t[b],100));var C="atomIdList";t[C]&&o(C)&&(h[C]=c(s(i(t[C]))));var U="altLocList";t[U]&&o(U)&&(h[U]=s(i(t[U]),new Uint8Array(u)));var A="occupancyList";t[A]&&o(A)&&(h[A]=l(t[A],100)),h.groupIdList=c(s(i(t.groupIdList))),h.groupTypeList=i(t.groupTypeList);var I="secStructList";t[I]&&o(I)&&(h[I]=n(t[I]));var w="insCodeList";t[w]&&o(w)&&(h[w]=s(i(t[w]),new Uint8Array(f)));var x="sequenceIndexList";t[x]&&o(x)&&(h[x]=c(s(i(t[x])))),h.chainIdList=e(t.chainIdList);var F="chainNameList";return t[F]&&o(F)&&(h[F]=e(t[F])),h}function d(t){function r(t){return String.fromCharCode.apply(null,t).replace(/\0/g,"")}function e(t){var r,e,n=0;for(r=0,e=u.numGroups;e>r;++r){for(var o=u.groupList[u.groupTypeList[r]],i=0,a=o.bondOrderList.length;a>i;++i)t(n+o.bondAtomList[2*i],n+o.bondAtomList[2*i+1],o.bondOrderList[i]);n+=o.atomNameList.length}if(u.bondAtomList)for(r=0,e=u.bondAtomList.length;e>r;r+=2)t(u.bondAtomList[r],u.bondAtomList[r+1],u.bondOrderList?u.bondOrderList[r/2]:null)}function n(t){for(var e=0,n=0,o=u.numGroups;o>n;++n)for(var i=u.groupList[u.groupTypeList[n]],a=0,s=i.atomNameList.length;s>a;++a)t(i.elementList[a],i.atomNameList[a],i.atomChargeList[a],u.xCoordList[e],u.yCoordList[e],u.zCoordList[e],u.bFactorList?u.bFactorList[e]:null,u.atomIdList?u.atomIdList[e]:null,u.altLocList?r([u.altLocList[e]]):null,u.occupancyList?u.occupancyList[e]:null),e+=1}function o(t){for(var e=0,n=0,o=u.numGroups;o>n;++n){var i=u.groupList[u.groupTypeList[n]],a=i.atomNameList.length;t(i.groupName,i.singleLetterCode,i.chemCompType,u.groupIdList[n],u.groupTypeList[n],u.secStructList?u.secStructList[n]:null,u.insCodeList?r([u.insCodeList[n]]):null,u.sequenceIndexList?u.sequenceIndexList[n]:null,e,a),e+=a}}function i(t){for(var e=0,n=0;n<u.numChains;++n){var o=u.groupsPerChain[n];t(r(u.chainIdList.subarray(n,n+4)),u.chainNameList?r(u.chainNameList.subarray(n,n+4)):null,e,o),e+=o}}function a(t){for(var r=0,e=0;e<u.numModels;++e){var n=u.chainsPerModel[e];t(r,n),r+=n}}var u=t;this.eachBond=e,this.eachAtom=n,this.eachGroup=o,this.eachChain=i,this.eachModel=a}function h(t,e){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n;return n=t instanceof Uint8Array?r(t):t,L(n,e)}var m=d;t.decode=h,t.Iterator=m});