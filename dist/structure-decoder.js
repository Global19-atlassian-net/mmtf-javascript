var StructureDecoder=function(){"use strict";function e(e,t){function r(e){for(var t={},r=0;e>r;r++){var n=i();t[n]=i()}return t}function n(r){var n=e.subarray(t,t+r);return t+=r,n}function a(r){var n=e.subarray(t,t+r),a=String.fromCharCode.apply(null,n);return t+=r,a}function o(e){for(var t=new Array(e),r=0;e>r;r++)t[r]=i();return t}function i(){var i,s,c,f=e[t];if(0===(128&f))return t++,f;if(128===(240&f))return s=15&f,t++,r(s);if(144===(240&f))return s=15&f,t++,o(s);if(160===(224&f))return s=31&f,t++,a(s);if(224===(224&f))return i=u.getInt8(t),t++,i;switch(f){case 192:return t++,null;case 194:return t++,!1;case 195:return t++,!0;case 196:return s=u.getUint8(t+1),t+=2,n(s);case 197:return s=u.getUint16(t+1),t+=3,n(s);case 198:return s=u.getUint32(t+1),t+=5,n(s);case 199:return s=u.getUint8(t+1),c=u.getUint8(t+2),t+=3,[c,n(s)];case 200:return s=u.getUint16(t+1),c=u.getUint8(t+3),t+=4,[c,n(s)];case 201:return s=u.getUint32(t+1),c=u.getUint8(t+5),t+=6,[c,n(s)];case 202:return i=u.getFloat32(t+1),t+=5,i;case 203:return i=u.getFloat64(t+1),t+=9,i;case 204:return i=e[t+1],t+=2,i;case 205:return i=u.getUint16(t+1),t+=3,i;case 206:return i=u.getUint32(t+1),t+=5,i;case 207:return i=u.getUint64(t+1),t+=9,i;case 208:return i=u.getInt8(t+1),t+=2,i;case 209:return i=u.getInt16(t+1),t+=3,i;case 210:return i=u.getInt32(t+1),t+=5,i;case 211:return i=u.getInt64(t+1),t+=9,i;case 212:return c=u.getUint8(t+1),i=u.getUint8(t+2),t+=3,0===c&&0===i?void 0:[c,i];case 213:return c=u.getUint8(t+1),t+=2,[c,n(2)];case 214:return c=u.getUint8(t+1),t+=2,[c,n(4)];case 215:return c=u.getUint8(t+1),t+=2,[c,n(8)];case 216:return c=u.getUint8(t+1),t+=2,[c,n(16)];case 217:return s=u.getUint8(t+1),t+=2,a(s);case 218:return s=u.getUint16(t+1),t+=3,a(s);case 219:return s=u.getUint32(t+1),t+=5,a(s);case 220:return s=u.getUint16(t+1),t+=3,o(s);case 221:return s=u.getUint32(t+1),t+=5,o(s);case 222:return s=u.getUint16(t+1),t+=3,r(s);case 223:return s=u.getUint32(t+1),t+=5,r(s);case 216:return s=u.getUint16(t+1),t+=3,buf(s);case 217:return s=u.getUint32(t+1),t+=5,buf(s)}throw new Error("Unknown type 0x"+f.toString(16))}t=t||0;var u=new DataView(e.buffer);this.parse=i}function t(t){var r=new e(t),n=r.parse();return n}function r(e){var t=e.buffer,r=e.byteOffset,n=e.byteLength;return t.slice(r,r+n)}function n(e,t){return t?t.set(new Int8Array(r(e))):t=new Int8Array(r(e)),t}function a(e,t){var n=r(e),a=new DataView(n),o=n.byteLength;t||(t=new Int16Array(o/2));for(var i=0;o>i;i+=2)t[i/2]=a.getInt16(i,!1);return t}function o(e,t){var n=r(e),a=new DataView(n),o=n.byteLength;t||(t=new Int32Array(o/4));for(var i=0;o>i;i+=4)t[i/4]=a.getInt32(i,!1);return t}function i(e,t,r){var n=e.length;r||(r=new Float32Array(n));for(var a=0;n>a;++a)r[a]=e[a]/t;return r}function u(e,t){var r,n;if(!t){var a=0;for(r=0,n=e.length;n>r;r+=2)a+=e[r+1];t=new e.constructor(a)}var o=0;for(r=0,n=e.length;n>r;r+=2)for(var i=e[r],u=e[r+1],s=0;u>s;++s)t[o]=i,o+=1;return t}function s(e){for(var t=1,r=e.length;r>t;++t)e[t]+=e[t-1];return e}function c(e,t,r){var n=e.length/2+t.length;r||(r=new Int32Array(n));for(var a=0,o=0,i=0,u=e.length;u>i;i+=2){var s=e[i],c=e[i+1];r[a]=s,0!==i&&(r[a]+=r[a-1]),a+=1;for(var f=0;c>f;++f)r[a]=r[a-1]+t[o],a+=1,o+=1}return r}function f(e,t,r,n){var u=c(o(e),a(t));return i(u,r,n)}function d(e){for(var t=o(e.resOrder),r=0,n=0,a=t.length;a>n;++n)r+=e.groupMap[t[n]].bondOrders.length;return{bondCount:r,atomCount:e.numAtoms,residueCount:e.resOrder.length/4,chainCount:e.chainList.length/4,modelCount:e.chainsPerModel.length}}function l(e,t,r){var a,i,c,l,h,m,g,_,S,v,C,b=(Object({},r),d(e)),y=b.bondCount,w=b.atomCount,U=b.residueCount,A=b.chainCount,I=b.modelCount;for(t?(g=t.bondStore,_=t.atomStore,S=t.residueStore,v=t.chainStore,C=t.modelStore):(g={atomIndex1:new Uint32Array(y),atomIndex2:new Uint32Array(y),bondOrder:new Uint8Array(y)},_={residueIndex:new Uint32Array(w),x:new Float32Array(w),y:new Float32Array(w),z:new Float32Array(w),bfactor:new Float32Array(w),element:new Uint8Array(3*w),serial:new Int32Array(w),hetero:new Int8Array(w),altloc:new Uint8Array(w),atomname:new Uint32Array(4*w)},S={chainIndex:new Uint32Array(U),atomOffset:new Uint32Array(U),atomCount:new Uint16Array(U),resno:new Int32Array(U),resname:new Uint8Array(5*U),sstruc:new Uint8Array(U)},v={modelIndex:new Uint16Array(A),residueOffset:new Uint32Array(A),residueCount:new Uint32Array(A),chainname:new Uint8Array(4*A)},C={chainOffset:new Uint32Array(I),chainCount:new Uint32Array(I)}),f(e.cartn_x_big,e.cartn_x_small,1e3,_.x),f(e.cartn_y_big,e.cartn_y_small,1e3,_.y),f(e.cartn_z_big,e.cartn_z_small,1e3,_.z),f(e.b_factor_big,e.b_factor_small,100,_.bfactor),s(u(o(e._atom_site_id),_.serial)),a=0,i=e._atom_site_label_alt_id.length;i>a;a+=2){var p=e._atom_site_label_alt_id[a];"?"===p?e._atom_site_label_alt_id[a]=0:e._atom_site_label_alt_id[a]=e._atom_site_label_alt_id[a].charCodeAt(0),e._atom_site_label_alt_id[a+1]=parseInt(e._atom_site_label_alt_id[a+1])}u(e._atom_site_label_alt_id,_.altloc),v.chainname.set(n(e.chainList));var x=0;e.chainsPerModel.forEach(function(e,t){for(C.chainOffset[t]=x,C.chainCount[t]=e,c=0;e>c;++c)v.modelIndex[c+x]=t;x+=e});var O=0;e.groupsPerChain.forEach(function(e,t){for(v.residueOffset[t]=O,v.residueCount[t]=e,c=0;e>c;++c)S.chainIndex[c+O]=t;O+=e});var M={0:"i",1:"s",2:"h",3:"e",4:"g",5:"b",6:"t",7:"l","-1":""};s(u(o(e._atom_site_auth_seq_id),S.resno));var F=o(e.resOrder),D=n(e.secStruct),z=0,L=0;for(a=0;U>a;++a){var k=e.groupMap[F[a]],B=k.hetFlag?1:0,E=k.atomInfo,P=E.length/2,R=k.bondIndices,V=k.bondOrders;for(c=0,l=V.length;l>c;++c)g.atomIndex1[L]=z+R[2*c],g.atomIndex2[L]=z+R[2*c+1],g.bondOrder[L]=V[c],L+=1;S.sstruc[a]=(M[D[a]]||"l").charCodeAt(),S.atomOffset[a]=z,S.atomCount[a]=P;var G=k.resName;for(c=0,l=G.length;l>c;++c)S.resname[5*a+c]=G.charCodeAt(c);for(c=0;P>c;++c){var T=E[2*c+1];for(h=0,m=T.length;m>h;++h)_.atomname[4*z+h]=T.charCodeAt(h);var j=E[2*c];for(h=0,m=j.length;m>h;++h)_.element[3*z+h]=j.charCodeAt(h);_.hetero[z]=B,_.residueIndex[z]=a,z+=1}}return{bondStore:g,atomStore:_,residueStore:S,chainStore:v,modelStore:C}}var h=function(e){function r(e,t){var r=performance.now(),n=l(S,e,t),a=performance.now();g.__structureDecodeTimeMs=a-r,g.bondStore=n.bondStore,g.atomStore=n.atomStore,g.residueStore=n.residueStore,g.chainStore=n.chainStore,g.modelStore=n.modelStore}function n(e){return[g.bondStore.atomIndex1[e],g.bondStore.atomIndex2[e],g.bondStore.bondOrder[e]]}function a(e){var t,r,n="";for(t=0;3>t&&(r=g.atomStore.element[3*e+t],r);++t)n+=String.fromCharCode(r);var a="";for(t=0;4>t&&(r=g.atomStore.atomname[4*e+t],r);++t)a+=String.fromCharCode(r);return[g.atomStore.residueIndex[e],g.atomStore.x[e],g.atomStore.y[e],g.atomStore.z[e],g.atomStore.bfactor[e],n,g.atomStore.serial[e],g.atomStore.hetero[e],String.fromCharCode(g.atomStore.altloc[e]),a]}function o(e){for(var t="",r=0;5>r;++r){var n=g.residueStore.resname[5*e+r];if(!n)break;t+=String.fromCharCode(n)}return[g.residueStore.chainIndex[e],g.residueStore.atomOffset[e],g.residueStore.atomCount[e],g.residueStore.resno[e],t,String.fromCharCode(g.residueStore.sstruc[e])]}function i(e){for(var t="",r=0;4>r;++r){var n=g.chainStore.chainname[4*e+r];if(!n)break;t+=String.fromCharCode(n)}return[g.chainStore.modelIndex[e],g.chainStore.residueOffset[e],g.chainStore.residueCount[e],t]}function u(e){return[g.modelStore.chainOffset[e],g.modelStore.chainCount[e]]}function s(e){for(var t=0;b>t;++t)e.apply(null,g.getBond(t))}function c(e){for(var t=0;y>t;++t)e.apply(null,g.getAtom(t))}function f(e){for(var t=0;w>t;++t)e.apply(null,g.getResidue(t))}function h(e){for(var t=0;U>t;++t)e.apply(null,g.getChain(t))}function m(e){for(var t=0;A>t;++t)e.apply(null,g.getModel(t))}var g=this;e instanceof ArrayBuffer?(g.buffer=e,e=new Uint8Array(e)):g.buffer=e.buffer;var _=performance.now(),S=t(e),v=performance.now();this.__msgpackDecodeTimeMs=v-_;var C=d(S),b=C.bondCount,y=C.atomCount,w=C.residueCount,U=C.chainCount,A=C.modelCount;this.unitCell=S.unitCell,this.spaceGroup=S.spaceGroup,this.bondCount=b,this.atomCount=y,this.residueCount=w,this.chainCount=U,this.modelCount=A,this.bondStore=void 0,this.atomStore=void 0,this.residueStore=void 0,this.chainStore=void 0,this.modelStore=void 0,this.decode=r,this.getBond=n,this.getAtom=a,this.getResidue=o,this.getChain=i,this.getModel=u,this.eachBond=s,this.eachAtom=c,this.eachResidue=f,this.eachChain=h,this.eachModel=m};return h}();